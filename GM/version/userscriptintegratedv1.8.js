// ==UserScript==
// @name         userscriptintegratedv1.8
// @namespace    https://gsfw.w3school.com
// @version      2024-06-24
// @description  add mutation observer
// @author       jui
// @match        https://*/*
// @grant        GM_xmlhttpRequest
// ==/UserScript==
'use strict';

//IFRAME function start:------------------------------------------------------------------------------------------------------------------------------------
(function withinuni() {
    // Check the current URL to see which @match triggered the script
    if (window.location.href.startsWith("https://sellercentral.amazon.co.uk/home")) {
        function eu1() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral.amazon.co.uk/performance/dashboard";https://sellercentral.amazon.com/performance/notifications
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:700px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';

            // Your code here...
        };
        function eu2() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral.amazon.co.uk/performance/notifications";
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:700px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';

            // Your code here...
        };
        function eu3() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral.amazon.co.uk/messaging/inbox-v3?fi=responseNeeded&&&";https://sellercentral.amazon.com/performance/notifications
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:1100px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';
            // Your code here...
        };
        function eu4() {
            window.open("https://sellercentral.amazon.co.uk/inventory/ref=xx_invmgr_favb_xx","_blank");
        };


        eu1();eu2();eu3();eu4();

    } else if (window.location.href.startsWith("https://sellercentral-japan.amazon.com/home")) {
        (function() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral-japan.amazon.com/performance/dashboard";https://sellercentral.amazon.com/performance/notifications
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:700px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';

            // Your code here...
        })();
        (function() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral-japan.amazon.com/performance/notifications";
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:700px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';

            // Your code here...
        })();
        (function() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral-japan.amazon.com/messaging/inbox-v3?fi=responseNeeded&&&";https://sellercentral.amazon.com/performance/notifications
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:1100px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';
            // Your code here...
        })();
        (function() {
            window.open("https://sellercentral-japan.amazon.com/inventory/ref=xx_invmgr_favb_xx","_blank");
        })();


        // Do something specific for product pages
    }else if (window.location.href.startsWith("https://sellercentral.amazon.com/home")) {


        (function() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral.amazon.com/performance/dashboard";https://sellercentral.amazon.com/performance/notifications
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:700px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';

            // Your code here...
        })();
        (function() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral.amazon.com/performance/notifications";
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:700px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';

            // Your code here...
        })();
        (function() {
            'use strict';
            const cdiv = document.createElement("iframe");
            document.getElementById("sc-navbar-container").appendChild(cdiv);
            const j="www.baidu.com"
            cdiv.src="https://sellercentral.amazon.com/messaging/inbox-v3?fi=responseNeeded&&&";https://sellercentral.amazon.com/performance/notifications
            //cdiv.width="1800";
            //cdiv.height="1000";
            //cdiv.style.cssText = 'position:absolute;top:300px;left:300px;width:200px;height:200px;-moz-border-radius:100px;border:1px  solid #ddd;-moz-box-shadow: 0px 0px 8px  #fff;display:none;';
            cdiv.style.cssText = 'width:1100px;height:1000px;-moz-border-radius:100px;border:6px dashed #ddd;-moz-box-shadow: 0px 0px 8px  #fff;resize: both';
            // Your code here...
        })();
        (function() {
            window.open("https://sellercentral.amazon.com/inventory/ref=xx_invmgr_favb_xx","_blank");
        })();



        // Do something specific for product pages
    }
    // ... add more conditions for other @match URLs
}

)();

//IFRAME function ends----------------------------------------------------------------------------------------------------

//listedit function starts----------------------------------------------------------------------------------------------------

(function(){
    if (window.location.href.startsWith("https://sellercentral.amazon.co.uk/abis/listing/edit")||window.location.href.startsWith("https://sellercentral.amazon.com/abis/listing/edit")||window.location.href.startsWith("https://sellercentral-japan.amazon.com/abis/listing/edit")){
        const styleSheet =`
.juibuttons{
background-color:green;}`
        const createcss=document.createElement("style");
        createcss.type="text/css";
        createcss.innerHTML=styleSheet;
        (document.head ||document.documentElement).appendChild(createcss);


        const cbtn=document.createElement("button");
        cbtn.className="juibuttons";
        cbtn.textContent="doreplace";
        cbtn.style.cssText = 'width:100px;height:40px;border:2px dashed #ddd;';
        cbtn.addEventListener("mouseover", () => {
            cbtn.style.backgroundColor = "rgba(255, 0, 0, 0.2)";
        });
        cbtn.addEventListener("mouseout", () => {
            cbtn.style.backgroundColor = ""; // Restore default color
        });
        document.getElementById("sc-navbar-container").appendChild(cbtn);

        const ctextarea = document.createElement("textarea");
        document.getElementById("sc-navbar-container").appendChild(ctextarea);
        ctextarea.style.cssText = 'font-size: 0.8rem; letter-spacing: 1px; width: 100px; height: 40px; border: 2px dashed #ddd;';
        //ctextarea.value=celements[0].textContent;



        cbtn.addEventListener("click", () => {

            const celements = [...document.querySelectorAll('.text-size-sm.text-secondary')];
            for (const a of celements) {
                a.textContent = a.textContent.replace(new RegExp(ctextarea.value, 'gi'), '');
                // csmallbtn.addEventListener("click", () => {navigator.clipboard.writeText(csmallbtn.parentElement.textContent)});
            };

        });


        const mbtn=document.createElement("button");
        mbtn.className="juibuttons";
        mbtn.textContent="createcopybutton";
        mbtn.style.cssText = 'width:100px;height:40px;border:2px dashed #ddd;';
        mbtn.addEventListener("mouseover", () => {
            mbtn.style.backgroundColor = "rgba(255, 0, 0, 0.2)";
        });
        mbtn.addEventListener("mouseout", () => {
            mbtn.style.backgroundColor = ""; // Restore default color
        });
        document.getElementById("sc-navbar-container").appendChild(mbtn);

        mbtn.addEventListener("click", jui);

        function jui(){

            const elements = [...document.querySelectorAll('.text-size-sm.text-secondary')];


            for (const element of elements) {

                const copyButton = document.createElement('button');
                copyButton.className="juibuttons";
                copyButton.textContent = "";
                copyButton.style.cssText = 'width:100px;height:40px;border:2px dashed #ddd;';
                copyButton.addEventListener("mouseover", () => {
                    copyButton.style.backgroundColor = "rgba(255, 0, 0, 0.2)";
                });
                copyButton.addEventListener("mouseout", () => {
                    copyButton.style.backgroundColor = ""; // Restore default color
                });
                copyButton.addEventListener("click",()=>{navigator.clipboard.writeText(copyButton.parentElement.textContent)});
                element.appendChild(copyButton);
            }
        }
    }
})();
//listedit function ends----------------------------------------------------------------------------------------------------
//performancet function starts----------------------------------------------------------------------------------------------------

(function(){
    if (window.location.href.startsWith("https://sellercentral.amazon.co.uk/performance/account/health/product-policies")||window.location.href.startsWith("https://sellercentral-japan.amazon.com/performance/account/health/product-policies")||window.location.href.startsWith("https://sellercentral.amazon.com/performance/account/health/product-policies")){
        const defaultBackgroundColor="rgba(221,221,221,1)";
        const openlinkbtn = document.createElement("button");
        const detailsbtn = document.createElement("button");

        document.getElementById("sc-navbar-container").appendChild(openlinkbtn);
        document.getElementById("sc-navbar-container").appendChild(detailsbtn);
        const ctextarea = document.createElement("textarea");
        document.getElementById("sc-navbar-container").appendChild(ctextarea);
        openlinkbtn.id="juibutton";
        openlinkbtn.textContent="retrievesku";
        detailsbtn.textContent="clickdetails";
        openlinkbtn.style.cssText = 'width:100px;height:40px;border:2px dashed #ddd;';
        detailsbtn.style.cssText = 'width:100px;height:40px;border:2px dashed #ddd;';
        ctextarea.style.cssText = 'font-size: 0.8rem; letter-spacing: 1px; width: 100px; height: 40px; border: 2px dashed #ddd;';
        ctextarea.id="juictextarea";


        detailsbtn.addEventListener("click", () => {
            const expanders = document.querySelectorAll('.ahd-pp-rp-view-detail-container kat-icon');

            expanders.forEach(expander => {
                // Option A: Using dispatchEvent (recommended)
                const clickEvent = new Event('click', { bubbles: true });
                expander.dispatchEvent(clickEvent);

                // Option B: Using click() (might be affected by bubbling)
                // expander.click();
            });
        });

        openlinkbtn.addEventListener("mouseover", () => {
            openlinkbtn.style.backgroundColor = "rgba(255, 0, 0, 0.2)";
        });
        openlinkbtn.addEventListener("mouseout", () => {
            openlinkbtn.style.backgroundColor = defaultBackgroundColor; // Restore default color
        });


        //retrieve starts----------------------------------------------------------------------------------------------------------

        function retrivesku050724(){
            ctextarea.value = "";
            const filteredSpans = [...document.querySelectorAll("span")].filter((span) => !span.hasAttribute("class") && span.textContent.includes("ASIN："));
            const asins = filteredSpans.map((filteredSpan) => {
                const replacedText = filteredSpan.textContent.replace(/ASIN：/gi, "");
                return replacedText;
            });
            const results = [];

            function asinprocess(asin){
                let inventoryhref="";
                if (window.location.href.startsWith("https://sellercentral.amazon.co.uk/performance/account/health/product-policies")) {
                    inventoryhref="https://sellercentral.amazon.co.uk/inventory/?ref=sp_st_ahd_abp_edit&search:";
                }else if(window.location.href.startsWith("https://sellercentral-japan.amazon.com/performance/account/health/product-policies")){
                    inventoryhref="https://sellercentral-japan.amazon.com/inventory/?ref=sp_st_ahd_abp_edit&search:"
                }else if(window.location.href.startsWith("https://sellercentral.amazon.com/performance/account/health/product-policies")){
                    inventoryhref="https://sellercentral.amazon.com/inventory/?ref=sp_st_ahd_abp_edit&search:"
                };
                const newHref = `${inventoryhref}${asin.replace(/&amp;/g, "&")}`;
                function gmrequest(newHref){
                    GM_xmlhttpRequest({
                        method: "GET",
                        url: newHref,
                        onload: function(response) {
                            const parsedHTML = response.responseText;
                            //alert(`${response.status}`);
                            ctextarea.value += `${response.status}\n`;
                            const doc = new DOMParser().parseFromString(parsedHTML, "text/html"); // Assuming HTML

                            const targetElements = doc.querySelectorAll(".a-link-normal.mt-link-content.mt-table-main");
                            let elementText = "";
                            for (const element of targetElements) {
                                elementText += element.textContent + "\n"; // Add newline for each element
                            }
                            console.log(`${asin}\n${elementText}`);
                            if(targetElements.length === 2) {
                                const textContent = targetElements[1].textContent; // Get first element's text
                                const trimmedContent = textContent.trim();
                                results.push(`${asin}\t\t${trimmedContent.replace(/[-_].*$/g, "")}`);
                            } else if (targetElements.length === 1){
                                const textContent = targetElements[0].textContent; // Get second element's text
                                const trimmedContent = textContent.trim();
                                results.push(`${asin}\t\t${trimmedContent.replace(/[-_].*$/g, "")}`);
                            }else{
                                results.push(`${asin}\t\t,`);
                            }

                            if (results.length === asins.length) {
                                ctextarea.value = results.join("\n");
                            }
                        }
                    })

                };

                gmrequest(newHref);


            };

asins.forEach((asin, index) => {setTimeout(() => asinprocess(asin), index * 200); ctextarea.value += index * 200 + ' ';});


         //   for (const asin of asins) {asinprocess(asin)}
        }


        openlinkbtn.addEventListener("click",retrivesku050724);
        //retrieve ends-----------------------------------------------------------------------------------

        const copybtn = document.createElement("button");
        document.getElementById("sc-navbar-container").appendChild(copybtn);
        copybtn.textContent="copy";
        copybtn.style.cssText = 'width:100px;height:40px;border:2px dashed #ddd;';
        copybtn.addEventListener("mouseover", () => {
            copybtn.style.backgroundColor = "rgba(255, 0, 0, 0.2)";
        });
        copybtn.addEventListener("mouseout", () => {
            copybtn.style.backgroundColor = defaultBackgroundColor; // Restore default color
        });

        copybtn.addEventListener("click", () => {
            const valuetextarea = document.getElementById("juictextarea");

            // Assuming Clipboard API is supported (not recommended for production)
            navigator.clipboard.writeText(valuetextarea.value)
                .then(() => {
                console.log("Copied to clipboard!");
            })
                .catch(err => {
                console.error("Failed to copy to clipboard:", err);
            });
        });
    }})();
//performancet function ends----------------------------------------------------------------------------------------------------

//mutationobserve function starts----------------------------------------------------------------------------------------------------

const panelamazon = document.createElement('div');
panelamazon.id = 'panelamazon';
panelamazon.innerHTML = `<h2>Panel</h2>
<textarea id="panelamazontextarea"></textarea>
`;
const styles = document.createElement('style');
styles.textContent = `
#panelamazon {
  position: fixed;
  top: 10px;
  left: 1800px;
  width: 2px;
  height: 2px;
  background-color: rgba(255, 255, 255, 0.12);
  border: 1px solid #ddd;
  padding: 0px;//top, right, bottom, left (in that order).
  z-index: 10;
  //display:none;
}
#panelamazontextarea {
  font-size: 0.8rem;
  letter-spacing: 1px;
  width: 100px;
  height: 44px;
  border: 2px dashed #ddd;
  background-color: transparent;
  resize: both;
  padding: 0px 15px 0px 15px;
  z-index: 10;
}
`;
panelamazon.innerHTML += `
`;
document.body.appendChild(panelamazon);
document.head.appendChild(styles);
const panelamazontextarea = document.getElementById('panelamazontextarea');


(function() {
    'use strict';
    const observer = new MutationObserver((mutations) => {
        panelamazontextarea.value +=console.log(`${mutations}`);
    });
    observer.observe(document.body, { childList: true, subtree: true });
})();
//mutationobserve function ends----------------------------------------------------------------------------------------------------
